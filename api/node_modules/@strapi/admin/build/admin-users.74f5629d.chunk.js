"use strict";(self.webpackChunk_strapi_admin=self.webpackChunk_strapi_admin||[]).push([[5199],{83196:function(C,o,t){var e=t(32735),s=t(60216),n=t.n(s),a=t(5636),d=t(39161),E=t.n(d),i=t(57269),u=t.n(i),g=t(13478),r=t.n(g);const S=({displayedFilters:M})=>{const[I,Z]=(0,e.useState)(!1),{formatMessage:y}=(0,a.useIntl)(),R=(0,e.useRef)(),U=()=>{Z(b=>!b)};return e.createElement(e.Fragment,null,e.createElement(d.Box,{paddingTop:1,paddingBottom:1},e.createElement(d.Button,{variant:"tertiary",ref:R,startIcon:e.createElement(i.Filter,null),onClick:U,size:"S"},y({id:"app.utils.filters",defaultMessage:"Filters"})),I&&e.createElement(g.FilterPopoverURLQuery,{displayedFilters:M,isVisible:I,onToggle:U,source:R})),e.createElement(g.FilterListURLQuery,{filtersSchema:M}))};S.propTypes={displayedFilters:n().arrayOf(n().shape({name:n().string.isRequired,metadatas:n().shape({label:n().string}),fieldSchema:n().shape({type:n().string})})).isRequired},o.Z=S},62658:function(C,o){const t={firstname:"",lastname:"",email:"",roles:[]};o.Z=t},61358:function(C,o){const t=[];o.Z=t},27549:function(C,o,t){t.r(o),t.d(o,{default:function(){return pe}});var e=t(32735),s=t(13478),n=t(72041),a=t(39161),d=t(57269),E=t(5141),i=t(5636),u=t(84968),g=t(60216),r=t.n(g),S=t(64421);const M=({canDelete:c,headers:f,entriesToDelete:_,onClickDelete:D,onSelectRow:T,withMainAction:k,withBulkActions:h,rows:v})=>{const{push:N,location:{pathname:z}}=(0,E.useHistory)(),{formatMessage:m}=(0,i.useIntl)();return e.createElement(a.Tbody,null,v.map(l=>{const K=_.findIndex(L=>L===l.id)!==-1;return e.createElement(a.Tr,{key:l.id,...(0,s.onRowClick)({fn:()=>N(`${z}/${l.id}`),condition:h})},k&&e.createElement(a.Td,{...s.stopPropagation},e.createElement(a.BaseCheckbox,{"aria-label":m({id:"app.component.table.select.one-entry",defaultMessage:"Select {target}"},{target:(0,S.Pp)(l.firstname,l.lastname)}),checked:K,onChange:()=>{T({name:l.id,value:!K})}})),f.map(({key:L,cellFormatter:A,name:F,...Q})=>e.createElement(a.Td,{key:L},typeof A=="function"?A(l,{key:L,name:F,formatMessage:m,...Q}):e.createElement(a.Typography,{textColor:"neutral800"},l[F]||"-"))),h&&e.createElement(a.Td,null,e.createElement(a.Flex,{justifyContent:"end"},e.createElement(a.IconButton,{onClick:()=>N(`${z}/${l.id}`),label:m({id:"app.component.table.edit",defaultMessage:"Edit {target}"},{target:(0,S.Pp)(l.firstname,l.lastname)}),noBorder:!0,icon:e.createElement(d.Pencil,null)}),c&&e.createElement(a.Box,{paddingLeft:1,...s.stopPropagation},e.createElement(a.IconButton,{onClick:()=>D(l.id),label:m({id:"global.delete-target",defaultMessage:"Delete {target}"},{target:(0,S.Pp)(l.firstname,l.lastname)}),noBorder:!0,icon:e.createElement(d.Trash,null)})))))}))};M.defaultProps={canDelete:!1,entriesToDelete:[],onClickDelete(){},onSelectRow(){},rows:[],withBulkActions:!1,withMainAction:!1},M.propTypes={canDelete:r().bool,entriesToDelete:r().array,headers:r().array.isRequired,onClickDelete:r().func,onSelectRow:r().func,rows:r().array,withBulkActions:r().bool,withMainAction:r().bool};var I=M,Z=t(83196),y=t(41925),R=t(83281),U=t(4397),x=[[{intlLabel:{id:"Auth.form.firstname.label",defaultMessage:"First name"},name:"firstname",placeholder:{id:"Auth.form.firstname.placeholder",defaultMessage:"e.g. Kai"},type:"text",size:{col:6,xs:12},required:!0},{intlLabel:{id:"Auth.form.lastname.label",defaultMessage:"Last name"},name:"lastname",placeholder:{id:"Auth.form.lastname.placeholder",defaultMessage:"e.g. Doe"},type:"text",size:{col:6,xs:12}}],[{intlLabel:{id:"Auth.form.email.label",defaultMessage:"Email"},name:"email",placeholder:{id:"Auth.form.email.placeholder",defaultMessage:"e.g. kai.doe@strapi.io"},type:"email",size:{col:6,xs:12},required:!0}]],P=t(5173),ee=P.Ry().shape({firstname:P.Z_().trim().required(s.translatedErrors.required),lastname:P.Z_(),email:P.Z_().email(s.translatedErrors.email).required(s.translatedErrors.required),roles:P.IX().min(1,s.translatedErrors.required).required(s.translatedErrors.required)}),te={create:{buttonSubmitLabel:{id:"app.containers.Users.ModalForm.footer.button-success",defaultMessage:"Invite user"},isDisabled:!1,next:"magic-link"},"magic-link":{buttonSubmitLabel:{id:"global.finish",defaultMessage:"Finish"},isDisabled:!0,next:null}};const $=(()=>window&&window.strapi&&window.strapi.isEE?t(64746).Z:t(62658).Z)(),ae=(()=>window&&window.strapi&&window.strapi.isEE?t(43116).Z:t(61358).Z)(),se=(()=>window&&window.strapi&&window.strapi.isEE?t(28890).Z:t(16325).Z)(),J=c=>{let{queryName:f,onToggle:_}=c;const[D,T]=(0,e.useState)("create"),[k,h]=(0,e.useState)(!1),[v,N]=(0,e.useState)(null),z=(0,u.useQueryClient)(),{formatMessage:m}=(0,i.useIntl)(),l=(0,s.useNotification)(),{lockApp:K,unlockApp:L}=(0,s.useOverlayBlocker)(),{post:A}=(0,s.useFetchClient)(),F=(0,u.useMutation)(B=>A("/admin/users",B),{async onSuccess(B){let{data:G}=B;N(G.data.registrationToken),await z.invalidateQueries(f),q(),h(!1)},onError(B){throw h(!1),l({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}}),B},onSettled(){L()}}),Q=m({id:"Settings.permissions.users.create",defaultMessage:"Invite new user"}),Y=async(B,G)=>{let{setErrors:X}=G;K(),h(!0);try{await F.mutateAsync(B)}catch(H){L(),H?.response?.data?.error.message==="Email already taken"&&X({email:H.response.data.error.message})}},q=()=>{p?T(p):_()},{buttonSubmitLabel:j,isDisabled:V,next:p}=te[D],ge=D==="create"?e.createElement(a.Button,{type:"submit",loading:k},m(j)):e.createElement(a.Button,{type:"button",loading:k,onClick:_},m(j));return e.createElement(a.ModalLayout,{onClose:_,labelledBy:"title"},e.createElement(a.ModalHeader,null,e.createElement(a.Breadcrumbs,{label:Q},e.createElement(a.Crumb,null,Q))),e.createElement(R.Formik,{initialValues:$,onSubmit:Y,validationSchema:ee,validateOnChange:!1},B=>{let{errors:G,handleChange:X,values:H}=B;return e.createElement(s.Form,null,e.createElement(a.ModalBody,null,e.createElement(a.Stack,{spacing:6},D!=="create"&&e.createElement(se,{registrationToken:v}),e.createElement(a.Box,null,e.createElement(a.Typography,{variant:"beta",as:"h2"},m({id:"app.components.Users.ModalCreateBody.block-title.details",defaultMessage:"User details"})),e.createElement(a.Box,{paddingTop:4},e.createElement(a.Stack,{spacing:1},e.createElement(a.Grid,{gap:5},x.map(re=>re.map(O=>e.createElement(a.GridItem,(0,y.Z)({key:O.name},O.size),e.createElement(s.GenericInput,(0,y.Z)({},O,{disabled:V,error:G[O.name],onChange:X,value:H[O.name]}))))))))),e.createElement(a.Box,null,e.createElement(a.Typography,{variant:"beta",as:"h2"},m({id:"global.roles",defaultMessage:"User's role"})),e.createElement(a.Box,{paddingTop:4},e.createElement(a.Grid,{gap:5},e.createElement(a.GridItem,{col:6,xs:12},e.createElement(U.Z,{disabled:V,error:G.roles,onChange:X,value:H.roles})),ae.map(re=>re.map(O=>e.createElement(a.GridItem,(0,y.Z)({key:O.name},O.size),e.createElement(s.GenericInput,(0,y.Z)({},O,{disabled:V,onChange:X,value:H[O.name]})))))))))),e.createElement(a.ModalFooter,{startActions:e.createElement(a.Button,{variant:"tertiary",onClick:_,type:"button"},m({id:"app.components.Button.cancel",defaultMessage:"Cancel"})),endActions:ge}))}))};J.propTypes={onToggle:r().func.isRequired,queryName:r().array.isRequired};var ne=J;const w=({pagination:c})=>e.createElement(a.Box,{paddingTop:4},e.createElement(a.Flex,{alignItems:"flex-end",justifyContent:"space-between"},e.createElement(s.PageSizeURLQuery,null),e.createElement(s.PaginationURLQuery,{pagination:c})));w.defaultProps={pagination:{pageCount:0,pageSize:10,total:0}},w.propTypes={pagination:r().shape({page:r().number,pageCount:r().number,pageSize:r().number,total:r().number})};var W=w;const ie=async(c,f)=>{const{get:_}=(0,s.getFetchClient)(),{data:{data:D}}=await _(`/admin/users${c}`);return f(),D},ce=async c=>{const{post:f}=(0,s.getFetchClient)();await f("/admin/users/batch-delete",{ids:c})};var de=[{name:"firstname",metadatas:{label:"Firstname"},fieldSchema:{type:"string"}},{name:"lastname",metadatas:{label:"Lastname"},fieldSchema:{type:"string"}},{name:"email",metadatas:{label:"Email"},fieldSchema:{type:"email"}},{name:"username",metadatas:{label:"Username"},fieldSchema:{type:"string"}},{name:"isActive",metadatas:{label:"Active user"},fieldSchema:{type:"boolean"}}],ue=[{name:"firstname",key:"firstname",metadatas:{label:{id:"Settings.permissions.users.firstname",defaultMessage:"Firstname"},sortable:!0}},{name:"lastname",key:"lastname",metadatas:{label:{id:"Settings.permissions.users.lastname",defaultMessage:"Lastname"},sortable:!0}},{key:"email",name:"email",metadatas:{label:{id:"Settings.permissions.users.email",defaultMessage:"Email"},sortable:!0}},{key:"roles",name:"roles",metadatas:{label:{id:"Settings.permissions.users.roles",defaultMessage:"Roles"},sortable:!1},cellFormatter({roles:c},{formatMessage:f}){return e.createElement(a.Typography,{textColor:"neutral800"},c.map(_=>f({id:`Settings.permissions.users.${_.code}`,defaultMessage:_.name})).join(`,
`))}},{key:"username",name:"username",metadatas:{label:{id:"Settings.permissions.users.username",defaultMessage:"Username"},sortable:!0}},{key:"isActive",name:"isActive",metadatas:{label:{id:"Settings.permissions.users.user-status",defaultMessage:"User status"},sortable:!1},cellFormatter({isActive:c},{formatMessage:f}){return e.createElement(a.Flex,null,e.createElement(s.Status,{isActive:c,variant:c?"success":"danger"}),e.createElement(a.Typography,{textColor:"neutral800"},f({id:c?"Settings.permissions.users.active":"Settings.permissions.users.inactive",defaultMessage:c?"Active":"Inactive"})))}}],me=()=>{const[c,f]=(0,e.useState)(!1),{allowedActions:{canCreate:_,canDelete:D,canRead:T}}=(0,s.useRBAC)(n.Z.settings.users),k=(0,u.useQueryClient)(),h=(0,s.useNotification)(),{formatMessage:v}=(0,i.useIntl)(),{search:N}=(0,E.useLocation)();(0,s.useFocusWhenNavigate)();const{notifyStatus:z}=(0,a.useNotifyAT)(),m=["users",N],l=ue.map(p=>({...p,metadatas:{...p.metadatas,label:v(p.metadatas.label)}})),K=v({id:"global.users",defaultMessage:"Users"}),L=()=>{z(v({id:"app.utils.notify.data-loaded",defaultMessage:"The {target} has loaded"},{target:K}))},{status:A,data:F,isFetching:Q}=(0,u.useQuery)(m,()=>ie(N,L),{enabled:T,keepPreviousData:!0,retry:!1,staleTime:1e3*20,onError(){h({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}})}}),Y=()=>{f(p=>!p)},q=(0,u.useMutation)(p=>ce(p),{async onSuccess(){await k.invalidateQueries(m)},onError(p){p?.response?.data?.data?h({type:"warning",message:p.response.data.data}):h({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}})}}),j=A!=="success"&&A!=="error"||A==="success"&&Q,V=_?e.createElement(a.Button,{"data-testid":"create-user-button",onClick:Y,startIcon:e.createElement(d.Envelop,null),size:"S"},v({id:"Settings.permissions.users.create",defaultMessage:"Invite new user"})):void 0;return e.createElement(a.Main,{"aria-busy":j},e.createElement(s.SettingsPageTitle,{name:"Users"}),e.createElement(a.HeaderLayout,{primaryAction:V,title:K,subtitle:v({id:"Settings.permissions.users.listview.header.subtitle",defaultMessage:"All the users who have access to the Strapi admin panel"})}),T&&e.createElement(a.ActionLayout,{startActions:e.createElement(e.Fragment,null,e.createElement(s.SearchURLQuery,{label:v({id:"app.component.search.label",defaultMessage:"Search for {target}"},{target:K})}),e.createElement(Z.Z,{displayedFilters:de}))}),e.createElement(a.ContentLayout,{canRead:T},!T&&e.createElement(s.NoPermissions,null),A==="error"&&e.createElement("div",null,"TODO: An error occurred"),T&&e.createElement(e.Fragment,null,e.createElement(s.DynamicTable,{contentType:"Users",isLoading:j,onConfirmDeleteAll:q.mutateAsync,onConfirmDelete:p=>q.mutateAsync([p]),headers:l,rows:F?.results,withBulkActions:!0,withMainAction:D},e.createElement(I,{canDelete:D,headers:l,rows:F?.results||[],withBulkActions:!0,withMainAction:D})),e.createElement(W,{pagination:F?.pagination}))),c&&e.createElement(ne,{onToggle:Y,queryName:m}))},pe=()=>e.createElement(s.CheckPagePermissions,{permissions:n.Z.settings.users.main},e.createElement(me,null))},76779:function(C,o,t){var e=t(32735),s=t(60216),n=t.n(s),a=t(39161),d=t.n(a),E=t(13478),i=t.n(E),u=t(57269),g=t.n(u),r=t(59087),S=t.n(r),M=t(5636);const I=({children:Z,target:y})=>{const R=(0,E.useNotification)(),{formatMessage:U}=(0,M.useIntl)(),b=()=>{R({type:"info",message:{id:"notification.link-copied"}})},x=U({id:"app.component.CopyToClipboard.label",defaultMessage:"Copy to clipboard"});return e.createElement(E.ContentBox,{endAction:e.createElement(r.CopyToClipboard,{onCopy:b,text:y},e.createElement(a.IconButton,{label:x,noBorder:!0,icon:e.createElement(u.Duplicate,null)})),title:y,titleEllipsis:!0,subtitle:Z,icon:e.createElement("span",{style:{fontSize:32}},"\u2709\uFE0F"),iconBackground:"neutral100"})};I.propTypes={children:n().oneOfType([n().element,n().string]).isRequired,target:n().string.isRequired},o.Z=I},16325:function(C,o,t){var e=t(32735),s=t(5636),n=t(60216),a=t.n(n),d=t(463),E=t(76779);const i=({registrationToken:u})=>{const{formatMessage:g}=(0,s.useIntl)(),r=`${window.location.origin}${d.Z}auth/register?registrationToken=${u}`;return e.createElement(E.Z,{target:r},g({id:"app.components.Users.MagicLink.connect",defaultMessage:"Copy and share this link to give access to this user"}))};i.defaultProps={registrationToken:""},i.propTypes={registrationToken:a().string},o.Z=i},4397:function(C,o,t){var e=t(32735),s=t(60216),n=t.n(s),a=t(5636),d=t(39161),E=t.n(d),i=t(84968),u=t.n(i),g=t(83292),r=t(57269),S=t.n(r),M=t(13478),I=t.n(M);const Z=g.keyframes`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(359deg);
  }
`,y=g.default.div`
  animation: ${Z} 2s infinite linear;
`,R=()=>e.createElement(y,null,e.createElement(r.Loader,null)),U=async()=>{const{get:x}=(0,M.getFetchClient)(),{data:P}=await x("/admin/roles");return P.data},b=({disabled:x,error:P,onChange:oe,value:ee})=>{const{status:le,data:te}=(0,i.useQuery)(["roles"],U,{staleTime:5e4}),{formatMessage:$}=(0,a.useIntl)(),ae=P?$({id:P,defaultMessage:P}):"",se=$({id:"app.components.Users.ModalCreateBody.block-title.roles",defaultMessage:"User's roles"}),J=$({id:"app.components.Users.ModalCreateBody.block-title.roles.description",defaultMessage:"A user can have one or several roles"}),ne=$({id:"app.components.Select.placeholder",defaultMessage:"Select"}),w=le==="loading"?e.createElement(R,null):void 0;return e.createElement(d.Select,{id:"roles",disabled:x,error:ae,hint:J,label:se,name:"roles",onChange:W=>{oe({target:{name:"roles",value:W}})},placeholder:ne,multi:!0,startIcon:w,value:ee,withTags:!0,required:!0},(te||[]).map(W=>e.createElement(d.Option,{key:W.id,value:W.id},$({id:`global.${W.code}`,defaultMessage:W.name}))))};b.defaultProps={disabled:!1,error:void 0},b.propTypes={disabled:n().bool,error:n().string,onChange:n().func.isRequired,value:n().array.isRequired},o.Z=b},64746:function(C,o,t){var e=t(62658);const s=strapi.features.isEnabled(strapi.features.SSO)?{useSSORegistration:!0}:{},n={...e.Z,...s};o.Z=n},43116:function(C,o){const t=strapi.features.isEnabled(strapi.features.SSO)?[[{intlLabel:{id:"Settings.permissions.users.form.sso",defaultMessage:"Connect with SSO"},hint:{id:"Settings.permissions.users.form.sso.description",defaultMessage:"When enabled (ON), users can login via SSO"},name:"useSSORegistration",type:"bool",size:{col:6,xs:12}}]]:[];o.Z=t},28890:function(C,o,t){var e=t(32735),s=t(5636),n=t(60216),a=t.n(n),d=t(463),E=t(76779);const i=({registrationToken:u})=>{const{formatMessage:g}=(0,s.useIntl)();return u?e.createElement(E.Z,{target:`${window.location.origin}${d.Z}auth/register?registrationToken=${u}`},g({id:"app.components.Users.MagicLink.connect",defaultMessage:"Copy and share this link to give access to this user"})):e.createElement(E.Z,{target:`${window.location.origin}${d.Z}auth/login`},g({id:"app.components.Users.MagicLink.connect.sso",defaultMessage:"Send this link to the user, the first login can be made via a SSO provider."}))};i.defaultProps={registrationToken:""},i.propTypes={registrationToken:a().string},o.Z=i}}]);
